# ui/cheat_sheet.py
import streamlit as st
import pandas as pd


def render_cheat_sheet_page():
    st.title("üìö –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫")
    st.caption("–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞ –ì–æ—Ä–æ–¥–∞.")

    tab_speed, tab_hp, tab_power, tab_eco, tab_mech, tab_balance = st.tabs([
        "üí® –°–∫–æ—Ä–æ—Å—Ç—å", "‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ", "‚öîÔ∏è –°–∏–ª–∞", "üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞", "üíÄ –ú–µ—Ö–∞–Ω–∏–∫–∏", "‚öñÔ∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä"
    ])

    # === –¢–ê–ë 1: –°–ö–û–†–û–°–¢–¨ ===
    with tab_speed:
        st.header("–°–∫–æ—Ä–æ—Å—Ç—å –∏ –ö—É–±–∏–∫–∏ –°–∫–æ—Ä–æ—Å—Ç–∏")
        st.markdown("*(–ü—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –ø—Ä–æ–∫–∞—á–∫–∏ –õ–æ–≤–∫–æ—Å—Ç–∏ –∏ –°–∫–æ—Ä–æ—Å—Ç–∏)*")

        data_speed = [
            {"Lvl": "90+", "Rank": "–ù–µ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ (Impurity)", "Dice Slots": "6x [30-40]", "Agility": "40 (+35)",
             "Speed": "40 (+30)"},
            {"Lvl": 80, "Rank": "–¶–≤–µ—Ç (–ó–≤–µ–∑–¥–∞ –£—Å–ª–æ–∂–Ω–µ–Ω)", "Dice Slots": "6x [24-27]", "Agility": "30 (+25)",
             "Speed": "30 (+20)"},
            {"Lvl": 65, "Rank": "Rank 1 (–ó–≤–µ–∑–¥–∞)", "Dice Slots": "5x [21-24], 1x [19-22]", "Agility": "25 (+20)",
             "Speed": "30 (+16)"},
            {"Lvl": 50, "Rank": "Rank 2 (–ö–æ—à–º–∞—Ä –£—Å–ª–æ–∂–Ω–µ–Ω)", "Dice Slots": "4x [19-22], 1x [14-17]",
             "Agility": "20 (+20)", "Speed": "25 (+16)"},
            {"Lvl": 43, "Rank": "Rank 3 (–ö–æ—à–º–∞—Ä)", "Dice Slots": "3x [16-19], 1x [13-16]", "Agility": "17 (+15)",
             "Speed": "22 (+12)"},
            {"Lvl": 36, "Rank": "Rank 4 (–ß—É–º–∞ –£—Å–ª–æ–∂–Ω–µ–Ω)", "Dice Slots": "3x [15-18], 1x [10-13]", "Agility": "14 (+15)",
             "Speed": "19 (+12)"},
            {"Lvl": 30, "Rank": "Rank 5 (–ß—É–º–∞)", "Dice Slots": "2x [13-16], 1x [10-13]", "Agility": "12 (+10)",
             "Speed": "16 (+8)"},
            {"Lvl": 24, "Rank": "Rank 6 (–õ–µ–≥–µ–Ω–¥–∞ –£—Å–ª–æ–∂–Ω–µ–Ω)", "Dice Slots": "2x [12-15], 1x [7-10]",
             "Agility": "10 (+10)", "Speed": "13 (+8)"},
            {"Lvl": 18, "Rank": "Rank 7 (–õ–µ–≥–µ–Ω–¥–∞)", "Dice Slots": "1x [10-13], 1x [7-10]", "Agility": "8 (+5)",
             "Speed": "10 (+4)"},
            {"Lvl": 12, "Rank": "Rank 8 (–ú–∏—Ñ)", "Dice Slots": "1x [9-12], 1x [4-7]", "Agility": "6 (+5)",
             "Speed": "7 (+4)"},
            {"Lvl": 6, "Rank": "Rank 9 (–°–ª—É—Ö–∏ –£—Å–ª–æ–∂–Ω–µ–Ω)", "Dice Slots": "1x [4-7]", "Agility": "4 (+0)",
             "Speed": "4 (+0)"},
            {"Lvl": 0, "Rank": "–ö—Ä—ã—Å—ã (–°–ª—É—Ö–∏)", "Dice Slots": "1x [1-3]", "Agility": "1 (+0)", "Speed": "1 (+0)"},
        ]
        df_speed = pd.DataFrame(data_speed)
        st.table(df_speed)

    # === –¢–ê–ë 2: –ó–î–û–†–û–í–¨–ï ===
    with tab_hp:
        st.header("–†–∞—Å—á–µ—Ç –ó–¥–æ—Ä–æ–≤—å—è (HP)")
        st.markdown("*(–ü—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –ø—Ä–æ–∫–∞—á–∫–∏ –°—Ç–æ–π–∫–æ—Å—Ç–∏)*")

        data_hp = [
            {"Lvl": "90+", "Rank": "–ù–µ—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ", "Endurance": 100, "Total HP": "~950-1200"},
            {"Lvl": 80, "Rank": "–¶–≤–µ—Ç (–ó–≤–µ–∑–¥–∞+)", "Endurance": 90, "Total HP": 726},
            {"Lvl": 65, "Rank": "Rank 1 (–ó–≤–µ–∑–¥–∞)", "Endurance": 80, "Total HP": 525},
            {"Lvl": 50, "Rank": "Rank 2 (–ö–æ—à–º–∞—Ä+)", "Endurance": 70, "Total HP": 351},
            {"Lvl": 43, "Rank": "Rank 3 (–ö–æ—à–º–∞—Ä)", "Endurance": 60, "Total HP": 293},
            {"Lvl": 36, "Rank": "Rank 4 (–ß—É–º–∞+)", "Endurance": 50, "Total HP": 239},
            {"Lvl": 30, "Rank": "Rank 5 (–ß—É–º–∞)", "Endurance": 40, "Total HP": 189},
            {"Lvl": 24, "Rank": "Rank 6 (–õ–µ–≥–µ–Ω–¥–∞+)", "Endurance": 30, "Total HP": 145},
            {"Lvl": 18, "Rank": "Rank 7 (–õ–µ–≥–µ–Ω–¥–∞)", "Endurance": 20, "Total HP": 104},
            {"Lvl": 12, "Rank": "Rank 8 (–ú–∏—Ñ)", "Endurance": 10, "Total HP": 68},
            {"Lvl": 6, "Rank": "Rank 9 (–°–ª—É—Ö–∏+)", "Endurance": 5, "Total HP": 42},
            {"Lvl": 0, "Rank": "–ö—Ä—ã—Å—ã", "Endurance": 0, "Total HP": 20},
        ]
        df_hp = pd.DataFrame(data_hp)
        st.dataframe(df_hp, use_container_width=True, hide_index=True)

    # === –¢–ê–ë 3: –†–û–õ–õ–´ ===
    with tab_power:
        st.header("–ß–∏—Å—Ç—ã–µ —Å—Ä–µ–¥–Ω–∏–µ —Ä–æ–ª–ª—ã –∫–∞—Ä—Ç—ã")
        st.caption("–î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–∏–ª—ã.")

        # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–æ–Ω—É—Å–∞
        data_power = [
            {
                "Lvl": 80, "Rank": "Color", "Base Roll": "25-32",
                "Str": "+5", "W.Type": "+5", "Talents": "+2", "W.Rank": "+5", "Imp": "+10",
                "Total Avg": "56 (29+27)"
            },
            {
                "Lvl": 65, "Rank": "Rank 1", "Base Roll": "21-27",
                "Str": "+5", "W.Type": "+5", "Talents": "+2", "W.Rank": "+5", "Imp": "+9",
                "Total Avg": "50 (24+26)"
            },
            {
                "Lvl": 50, "Rank": "Rank 2", "Base Roll": "17-22",
                "Str": "+4", "W.Type": "+5", "Talents": "+2", "W.Rank": "+4", "Imp": "+8",
                "Total Avg": "42 (19+23)"
            },
            {
                "Lvl": 43, "Rank": "Rank 3", "Base Roll": "14-19",
                "Str": "+4", "W.Type": "+4", "Talents": "+2", "W.Rank": "+4", "Imp": "+7",
                "Total Avg": "38 (17+21)"
            },
            {
                "Lvl": 36, "Rank": "Rank 4", "Base Roll": "11-16",
                "Str": "+3", "W.Type": "+4", "Talents": "+2", "W.Rank": "+3", "Imp": "+6",
                "Total Avg": "31 (13+18)"
            },
            {
                "Lvl": 30, "Rank": "Rank 5", "Base Roll": "9-13",
                "Str": "+2", "W.Type": "+3", "Talents": "+2", "W.Rank": "+3", "Imp": "+5",
                "Total Avg": "26 (11+15)"
            },
            {
                "Lvl": 24, "Rank": "Rank 6", "Base Roll": "7-10",
                "Str": "+2", "W.Type": "+3", "Talents": "0", "W.Rank": "+3", "Imp": "+4",
                "Total Avg": "20 (8+12)"
            },
            {
                "Lvl": 18, "Rank": "Rank 7", "Base Roll": "5-7",
                "Str": "+2", "W.Type": "+2", "Talents": "0", "W.Rank": "+2", "Imp": "+3",
                "Total Avg": "15 (6+9)"
            },
            {
                "Lvl": 12, "Rank": "Rank 8", "Base Roll": "4-6",
                "Str": "+1", "W.Type": "+1", "Talents": "0", "W.Rank": "+1", "Imp": "+2",
                "Total Avg": "10 (5+5)"
            },
            {
                "Lvl": 6, "Rank": "Rank 9", "Base Roll": "3-5",
                "Str": "1/0", "W.Type": "1/0", "Talents": "0", "W.Rank": "0/1", "Imp": "+1",
                "Total Avg": "9 / 4"
            },
        ]

        df_power = pd.DataFrame(data_power)
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
        st.table(df_power)

        st.info(
            "**–õ–µ–≥–µ–Ω–¥–∞:** Str = –°–∏–ª–∞ | W.Type = –¢–∏–ø –æ—Ä—É–∂–∏—è | Talents = –ë–æ–Ω—É—Å –≤–µ—Ç–æ–∫ | W.Rank = –†–∞–Ω–≥ –æ—Ä—É–∂–∏—è | Imp = –ò–º–ø–ª–∞–Ω—Ç—ã")

    # === –¢–ê–ë 4: –≠–ö–û–ù–û–ú–ò–ö–ê ===
    with tab_eco:
        st.header("üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –ì–æ—Ä–æ–¥–∞")

        with st.container(border=True):
            st.subheader("–î–æ—Ö–æ–¥—ã")
            st.metric("–°—Ä–µ–¥–Ω—è—è –ó–ü –ü–µ—Ä—å–µ–≤ (–≤ –º–µ—Å—è—Ü)", "40,000,000 –ê–Ω", help="–ß—É—Ç—å –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã –≤ –ì–Ω–µ–∑–¥–µ")

        st.divider()

        st.subheader("üìã –ü—Ä–∞–π—Å-–ª–∏—Å—Ç –Ω–∞ –õ–∏–∫–≤–∏–¥–∞—Ü–∏—é (–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ)")
        st.caption("–¶–µ–Ω—ã –¥–ª—è –ª–µ–≥–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤. –ù–µ–ª–µ–≥–∞–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Å—Ç–æ—è—Ç –¥–æ—Ä–æ–∂–µ. –¶–µ–Ω—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ü–µ–ª–µ–π.")

        eco_data = [
            {"–¶–µ–ª—å": "10 –ö—Ä—ã—Å", "–°—Ç–æ–∏–º–æ—Å—Ç—å (–ê–Ω)": "10,000"},
            {"–¶–µ–ª—å": "–ñ–∏–ª–µ—Ü –ü–æ–¥–≤–æ—Ä–æ—Ç–µ–Ω / –ü—Ä–µ—Å—Ç—É–ø–Ω–∏–∫ (< 9 —Ä–∞–Ω–≥–∞)", "–°—Ç–æ–∏–º–æ—Å—Ç—å (–ê–Ω)": "10,000 - 100,000"},
            {"–¶–µ–ª—å": "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ 9 —Ä–∞–Ω–≥–∞", "–°—Ç–æ–∏–º–æ—Å—Ç—å (–ê–Ω)": "100,000 - 500,000"},
            {"–¶–µ–ª—å": "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ 7-8 —Ä–∞–Ω–≥–∞", "–°—Ç–æ–∏–º–æ—Å—Ç—å (–ê–Ω)": "500,000 - 3,000,000"},
            {"–¶–µ–ª—å": "–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫ 5-6 —Ä–∞–Ω–≥–∞", "–°—Ç–æ–∏–º–æ—Å—Ç—å (–ê–Ω)": "3,000,000 - 10,000,000"},
            {"–¶–µ–ª—å": "–í—ã—Å–æ–∫–∏–µ —Ä–∞–Ω–≥–∏ (–ó–≤–µ–∑–¥–∞ / –¶–≤–µ—Ç)", "–°—Ç–æ–∏–º–æ—Å—Ç—å (–ê–Ω)": "100,000,000 - 1,000,000,000+"},
        ]

        df_eco = pd.DataFrame(eco_data)
        st.table(df_eco)

        st.info(
            "üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è —Ä–∞–Ω–≥–æ–≤ –≤—ã—à–µ 5-–≥–æ (–ì–æ—Ä–æ–¥—Å–∫–∞—è –ß—É–º–∞) —Ü–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ (–ø—Ä–∏–º–µ—Ä–Ω–æ —Ö10 –∑–∞ —Ä–∞–Ω–≥), –Ω–æ –±–æ–ª—å—à–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∏ —Ü–µ–ª–µ–π, —á–µ–º –æ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∞–π—Å–∞.")
    # === –¢–ê–ë 5: –ú–ï–•–ê–ù–ò–ö–ò ===
    with tab_mech:
        st.header("üíÄ –û—Å–æ–±—ã–µ –°–æ—Å—Ç–æ—è–Ω–∏—è")
        c1, c2 = st.columns(2)
        with c1:
            with st.container(border=True):
                st.subheader("üíî –ë–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (HP < 0)")
                st.markdown("...")  # (–¢–µ–∫—Å—Ç –º–µ—Ö–∞–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –º—ã –¥–æ–±–∞–≤–ª—è–ª–∏ —Ä–∞–Ω–µ–µ)
        with c2:
            with st.container(border=True):
                st.subheader("ü§Ø –ü–∞–Ω–∏–∫–∞ / –ò—Å–∫–∞–∂–µ–Ω–∏–µ (SP < 0)")
                st.markdown("...")  # (–¢–µ–∫—Å—Ç –º–µ—Ö–∞–Ω–∏–∫–∏)
        # === –¢–ê–ë 6: –ë–ê–õ–ê–ù–° (–ö–û–ù–°–¢–†–£–ö–¢–û–†) ===
    with tab_balance:
        st.header("‚öñÔ∏è –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ë–∞–ª–∞–Ω—Å–∞ –ö–∞—Ä—Ç")
        st.caption("–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç.")

        # --- 1. –¢–∞–±–ª–∏—Ü–∞ –±–∞–∑–æ–≤—ã—Ö –±—é–¥–∂–µ—Ç–æ–≤ ---
        with st.expander("üìä –¢–∞–±–ª–∏—Ü–∞ –ë—é–¥–∂–µ—Ç–æ–≤ (Power Budget)", expanded=True):
            budget_data = [
                {"Rank": 1, "Budget": 14, "Max Dice": 3, "Avg Roll/Die (1d)": "12-14", "Avg Roll/Die (2d)": "6-7",
                 "Avg Roll/Die (3d)": "3-4"},
                {"Rank": 2, "Budget": 20, "Max Dice": 4, "Avg Roll/Die (1d)": "18-20", "Avg Roll/Die (2d)": "8-10",
                 "Avg Roll/Die (3d)": "5-6"},
                {"Rank": 3, "Budget": 28, "Max Dice": 4, "Avg Roll/Die (1d)": "26-28", "Avg Roll/Die (2d)": "12-14",
                 "Avg Roll/Die (3d)": "7-9"},
                {"Rank": 4, "Budget": 38, "Max Dice": 5, "Avg Roll/Die (1d)": "36-38", "Avg Roll/Die (2d)": "16-18",
                 "Avg Roll/Die (3d)": "10-12"},
                {"Rank": 5, "Budget": 50, "Max Dice": 5, "Avg Roll/Die (1d)": "48-50", "Avg Roll/Die (2d)": "22-24",
                 "Avg Roll/Die (3d)": "14-16"},
            ]
            st.table(pd.DataFrame(budget_data))
            st.caption("*Budget = –û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—É–º–º–∞ —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤ –∫–∞—Ä—Ç—ã.*")

        st.divider()

        # --- 2. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä ---
        c_set, c_res = st.columns([1, 1])

        with c_set:
            st.subheader("üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞")
            rank = st.selectbox("–†–∞–Ω–≥ –∫–∞—Ä—Ç—ã", [1, 2, 3, 4, 5], index=0)
            ctype = st.selectbox("–¢–∏–ø –∫–∞—Ä—Ç—ã",
                                 ["Melee (100%)", "Offensive (115%)", "Ranged (125%)", "Mass Attack (135%)"],
                                 index=0)
            dice_count = st.slider("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–π—Å–æ–≤", 1, 5, 2)

            st.markdown("**–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã:**")
            effects_count = st.number_input("–ö–æ–ª-–≤–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ–º—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (-15% power)", 0, 5, 0,
                                            help="Bleed, Burn, Buffs etc.")
            cond_hard = st.number_input("–°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (+20% power)", 0, 3, 0, help="On Hit, High Roll req.")
            cond_easy = st.number_input("–õ–µ–≥–∫–∏–µ —É—Å–ª–æ–≤–∏—è (-10% power)", 0, 3, 0, help="On Use, Combat Start.")

            variance = st.slider("–†–∞–∑–±—Ä–æ—Å (Variance)", 0, 20, 4,
                                 help="–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É Min –∏ Max. –ú–∞–ª—ã–π —Ä–∞–∑–±—Ä–æ—Å —Å—Ç–æ–∏—Ç –¥–æ—Ä–æ–∂–µ!")

        with c_res:
            st.subheader("üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç")

            # 1. Base Budget
            base_budgets = {1: 14, 2: 20, 3: 28, 4: 38, 5: 50}
            budget = base_budgets[rank]

            # 2. Type Penalty (Cost)
            type_mult = 1.0
            if "Offensive" in ctype: type_mult = 1.15
            if "Ranged" in ctype: type_mult = 1.25
            if "Mass" in ctype: type_mult = 1.35

            # 3. Effect Penalty (–°–Ω–∏–∂–∞–µ—Ç –±—é–¥–∂–µ—Ç)
            eff_pen = effects_count * 0.15

            # 4. Condition Bonus/Penalty
            cond_mod = (cond_hard * 0.20) - (cond_easy * 0.10)

            # –ò—Ç–æ–≥–æ–≤—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            # (1 - –®—Ç—Ä–∞—Ñ—ã –∑–∞ —ç—Ñ—Ñ–µ–∫—Ç—ã + –ë–æ–Ω—É—Å—ã –∑–∞ —É—Å–ª–æ–≤–∏—è)
            power_mod = 1.0 - eff_pen + cond_mod

            # –î–æ—Å—Ç—É–ø–Ω—ã–π –±—é–¥–∂–µ—Ç —Å —É—á–µ—Ç–æ–º —Ç–∏–ø–∞ –∫–∞—Ä—Ç—ã (–¥–µ–ª–∏–º, —Ç.–∫. "–¥–æ—Ä–æ–∂–µ" –∑–Ω–∞—á–∏—Ç –º–µ–Ω—å—à–µ —Å—Ç–∞—Ç–æ–≤)
            # –ò —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å–∏–ª—ã
            final_budget = (budget / type_mult) * power_mod

            # 5. Dice Split Logic (User: "1 die is stronger")
            # –ï—Å–ª–∏ –¥–∞–π—Å–æ–≤ –º–Ω–æ–≥–æ, –±—é–¥–∂–µ—Ç –¥–µ–ª–∏—Ç—Å—è, –Ω–æ –µ—Å—Ç—å "–Ω–∞–ª–æ–≥ –Ω–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ" –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç –±–æ–Ω—É—Å –∑–∞ —Å–∏–Ω–µ—Ä–≥–∏—é?
            # –í LoR –º–Ω–æ–≥–æ –¥–∞–π—Å–æ–≤ = –∫—Ä—É—Ç–æ (–º–Ω–æ–≥–æ –∫–ª—ç—à–µ–π). –ü–æ—ç—Ç–æ–º—É –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–∞–π—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–∞–±–µ–µ.
            # –ü—Ä–æ—Å—Ç–æ –¥–µ–ª–∏–º –±—é–¥–∂–µ—Ç –Ω–∞ –∫–æ–ª-–≤–æ –¥–∞–π—Å–æ–≤.
            avg_val_per_die = final_budget / dice_count

            # 6. Variance Adjustment (Reliability Cost)
            # –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å —Å—Ç–æ–∏—Ç –¥–æ—Ä–æ–≥–æ.
            # –ï—Å–ª–∏ —Ä–∞–∑–±—Ä–æ—Å (Variance) –º–∞–ª–µ–Ω—å–∫–∏–π (0-3), —ç—Ç–æ –¥–æ—Ä–æ–≥–æ -> Avg –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ.
            # –ï—Å–ª–∏ —Ä–∞–∑–±—Ä–æ—Å –±–æ–ª—å—à–æ–π (10+), —ç—Ç–æ –¥–µ—à–µ–≤–æ -> Avg –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—à–µ.

            # –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–±—Ä–æ—Å ~4.
            # –ï—Å–ª–∏ user –≤—ã–±—Ä–∞–ª 10 -> Variance Bonus +X% to Avg.
            # –ï—Å–ª–∏ user –≤—ã–±—Ä–∞–ª 0 -> Variance Penalty -Y% to Avg.

            var_factor = 1.0 + ((variance - 4) * 0.02)  # +2% –∑–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É —Ä–∞–∑–±—Ä–æ—Å–∞ –≤—ã—à–µ 4

            final_avg = avg_val_per_die * var_factor

            # –†–∞—Å—á–µ—Ç Min/Max
            # Min = Avg - (Var/2)
            # Max = Avg + (Var/2)

            d_min = int(final_avg - (variance / 2))
            d_max = int(final_avg + (variance / 2))

            # Fix negative
            if d_min < 1:
                d_min = 1
                d_max = 1 + variance

            with st.container(border=True):
                st.metric("–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ", f"{final_avg:.1f}")
                st.markdown(f"### üé≤ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –¥–∞–π—Å:")
                st.markdown(f"# **{d_min} ~ {d_max}**")

                st.caption(f"Budget: {final_budget:.1f} | Var Factor: {var_factor:.2f}")

            st.info("""
                **–õ–æ–≥–∏–∫–∞:**
                * **–ú–∞—Å—Å/–†–µ–Ω–¥–∂** –∞—Ç–∞–∫–∏ –∏–º–µ—é—Ç –º–µ–Ω—å—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (-25-35%).
                * **–≠—Ñ—Ñ–µ–∫—Ç—ã** (–ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –∏ —Ç.–¥.) —Å–Ω–∏–∂–∞—é—Ç —Å–∏–ª—É –∫—É–±–∏–∫–∞.
                * **–°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è** (On Hit) –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–¥–µ–ª–∞—Ç—å –∫—É–±–∏–∫ —Å–∏–ª—å–Ω–µ–µ.
                * **–ë–æ–ª—å—à–æ–π —Ä–∞–∑–±—Ä–æ—Å** (1~20) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–µ—Ç—å –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ —Å—Ä–µ–¥–Ω–µ–µ/–º–∞–∫—Å –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ —Ä–∏—Å–∫.
                * **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–Ω** (5~5) —Å—Ç–æ–∏—Ç –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ, –ø–æ—ç—Ç–æ–º—É –∑–Ω–∞—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–∏–∑–∫–∏–º.
                """)